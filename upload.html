<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Upload Blog Post</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/styles.css">
  <style>
    body {
      background: #f8fafc;
      font-family: 'Inter', sans-serif;
      margin: 0;
      color: #18181b;
    }
    header {
      background: #fff;
      box-shadow: 0 2px 12px 0 rgba(0,0,0,0.04);
      padding: 1.5rem 0;
      margin-bottom: 2rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding-left: 2rem;
      padding-right: 2rem;
    }
    .logo {
      font-size: 2rem;
      font-weight: 700;
      color: #2563eb;
      letter-spacing: 1px;
    }
    nav a {
      margin-left: 2rem;
      text-decoration: none;
      color: #2563eb;
      font-weight: 600;
      font-size: 1.1rem;
      transition: color 0.2s;
    }
    nav a:hover {
      color: #1e293b;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
      padding: 0 1.5rem;
    }
    .section-title {
      font-size: 2.2rem;
      font-weight: 700;
      text-align: center;
      margin-bottom: 2.5rem;
      letter-spacing: -1px;
      color: #18181b;
    }
    .upload-card {
      background: #fff;
      border-radius: 1.25rem;
      box-shadow: 0 4px 24px 0 rgba(37,99,235,0.08), 0 1.5px 6px 0 rgba(0,0,0,0.03);
      padding: 2.5rem 2rem 2rem 2rem;
      margin-bottom: 2.5rem;
      border: 1px solid #e0e7ef;
      transition: box-shadow 0.18s, border-color 0.18s;
    }
    .upload-card:hover {
      box-shadow: 0 8px 32px 0 rgba(37,99,235,0.13), 0 2px 8px 0 rgba(0,0,0,0.04);
      border-color: #2563eb33;
    }
    .upload-form label {
      display: block;
      margin-bottom: 1.2rem;
    }
    .upload-form input[type="text"],
    .upload-form textarea {
      width: 100%;
      padding: 0.7rem 1rem;
      border: 1.5px solid #e0e7ef;
      border-radius: 0.7rem;
      font-size: 1rem;
      margin-top: 0.4rem;
      background: #f9fafb;
      transition: border-color 0.2s;
    }
    .upload-form input[type="text"]:focus,
    .upload-form textarea:focus {
      border-color: #2563eb;
      outline: none;
      background: #fff;
    }
    .upload-form input[type="file"] {
      margin-top: 0.4rem;
      font-size: 1rem;
    }
    .upload-form button[type="submit"] {
      width: 100%;
      padding: 0.9rem 0;
      background: linear-gradient(90deg, #2563eb 60%, #1e40af 100%);
      color: #fff;
      font-weight: 700;
      font-size: 1.1rem;
      border: none;
      border-radius: 0.7rem;
      box-shadow: 0 2px 8px 0 rgba(37,99,235,0.08);
      cursor: pointer;
      transition: background 0.2s, box-shadow 0.2s;
      margin-top: 1.2rem;
    }
    .upload-form button[type="submit"]:hover {
      background: linear-gradient(90deg, #1e40af 0%, #2563eb 100%);
      box-shadow: 0 4px 16px 0 rgba(37,99,235,0.13);
    }
    @media (max-width: 600px) {
      .container { padding: 0 0.5rem; }
      .upload-card { padding: 1.2rem 0.5rem; }
      .section-title { font-size: 1.5rem; }
      .logo { font-size: 1.3rem; }
      header { flex-direction: column; gap: 1rem; }
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">Aneebonâ€™s Blog</div>
    <nav>
      <a href="index.html">Home</a>
      <a href="blog.html">Blog Posts</a>
    </nav>
  </header>
  <main class="container">
    <h1 class="section-title">Create a New Blog Post</h1>
    <div class="upload-card" id="blogManagerCard">
      <h2 style="margin-bottom:1rem;">Manage Your Blogs</h2>
      <div id="blogManagerList"></div>
    </div>
    <div class="upload-card">
      <form class="upload-form" id="adminUploadForm" autocomplete="off">
        <label>
          <span class="block font-semibold mb-1">Title</span>
          <input type="text" name="title" placeholder="Enter blog title" required />
        </label>
        <label>
          <span class="block font-semibold mb-1">Summary</span>
          <textarea name="summary" rows="3" placeholder="Enter a short summary..." required></textarea>
        </label>
        <label>
          <span class="block font-semibold mb-1">Tags <span style="color:#94a3b8;font-weight:400;">(comma-separated)</span></span>
          <input type="text" name="tags" placeholder="e.g. AI, Web Development" />
        </label>
        <label>
          <span class="block font-semibold mb-1">Featured Image</span>
          <input type="file" name="image" accept="image/*" />
        </label>
        <label>
          <span class="block font-semibold mb-1">Media (Images, Videos, Files)</span>
          <input type="file" name="media" accept="image/*,video/*,.pdf,.doc,.docx,.ppt,.pptx,.xls,.xlsx,.txt" multiple />
        </label>
        <label>
          <span class="block font-semibold mb-1">Content</span>
          <textarea name="content" rows="6" placeholder="Full blog content..." required></textarea>
        </label>
        <button type="submit">
          Upload Blog Post
        </button>
      </form>
    </div>
    <div id="adminLoginBox" style="margin-bottom:2rem;">
      <form id="adminLoginForm">
        <input type="text" id="adminUsername" placeholder="Username" required style="margin-bottom:0.5rem;width:100%;padding:0.5rem;">
        <input type="password" id="adminPassword" placeholder="Password" required style="margin-bottom:0.5rem;width:100%;padding:0.5rem;">
        <button type="submit" style="width:100%;padding:0.7rem;background:#2563eb;color:#fff;border:none;border-radius:5px;font-weight:700;">Admin Login</button>
      </form>
    </div>
  </main>
  <script>
function fetchMyBlogs() {
  fetch('/api/posts')
    .then(res => res.json())
    .then(posts => {
      const list = document.getElementById('blogManagerList');
      list.innerHTML = '';
      posts.forEach(post => {
        const div = document.createElement('div');
        div.style = "border-bottom:1px solid #eee;padding:0.5rem 0;display:flex;align-items:center;gap:1rem;";
        div.innerHTML = `
          <img src="${post.image_url || ''}" style="width:60px;height:40px;object-fit:cover;border-radius:6px;">
          <span style="flex:1;font-weight:600;">${post.title}</span>
          <button onclick="editBlog(${post.id})" style="background:#2563eb;color:#fff;border:none;padding:0.3rem 1rem;border-radius:5px;cursor:pointer;">Edit</button>
          <button onclick="deleteBlog(${post.id})" style="background:#ef4444;color:#fff;border:none;padding:0.3rem 1rem;border-radius:5px;cursor:pointer;">Delete</button>
        `;
        list.appendChild(div);
      });
    });
}
fetchMyBlogs();

function editBlog(id) {
  fetch('/api/posts')
    .then(res => res.json())
    .then(posts => {
      const post = posts.find(p => p.id === id);
      if (!post) return alert('Blog not found!');
      // Fill the upload form with blog data
      document.querySelector('[name="title"]').value = post.title;
      document.querySelector('[name="summary"]').value = post.summary;
      document.querySelector('[name="tags"]').value = post.tags || '';
      document.querySelector('[name="content"]').value = post.content;
      document.getElementById('adminUploadForm').setAttribute('data-edit-id', id);
      window.scrollTo({top: 0, behavior: 'smooth'});
    });
}

function deleteBlog(id) {
  if (!confirm('Are you sure you want to delete this blog?')) return;
  fetch(`/api/posts/${id}`, { method: 'DELETE' })
    .then(res => res.json())
    .then(() => {
      alert('Blog deleted!');
      fetchMyBlogs();
    });
}

// Modify upload form submit for edit mode
document.getElementById('adminUploadForm').addEventListener('submit', function(e) {
  e.preventDefault();
  const formData = new FormData(this);
  const editId = this.getAttribute('data-edit-id');
  let url = '/api/posts';
  let method = 'POST';
  if (editId) {
    url = `/api/posts/${editId}`;
    method = 'PUT';
  }
  fetch(url, {
    method: method,
    body: formData
  })
  .then(res => {
    if (!res.ok) throw new Error('Failed to upload');
    return res.json();
  })
  .then(() => {
    alert(editId ? 'Blog updated!' : 'Blog post created!');
    this.reset();
    this.removeAttribute('data-edit-id');
    fetchMyBlogs();
  })
  .catch(() => alert('Error uploading post'));
});
  </script>
</body>
</html>